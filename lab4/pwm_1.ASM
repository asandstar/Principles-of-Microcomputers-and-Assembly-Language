	ORG 0000H
	LJMP MAIN
	ORG 0003H
	LJMP INT_KEY1
	ORG 0013H
	LJMP INT_KEY2

	ORG 0100H
MAIN:
	MOV TMOD,#11H ;T1-mode1, T0-mode1
	SETB P1.0
	MOV R0,#0F1H
	MOV R1,#99H
	MOV R2,#0C6H
	MOV R3,#66H
	MOV TH0,R0
	MOV TL0,R1
	MOV TH1,R2
	MOV TL1,R3
	SETB EA
	SETB IT0
	SETB IT1
	SETB EX0
	SETB EX1
TIME0:
	MOV TH0,R0
	MOV TL0,R1	
	SETB TR0
CHECK:
	JBC TF0,OVERFLOW0
	LJMP CHECK
OVERFLOW0:
	CLR P1.0
	CLR TR0
TIME1:
	MOV TH1,R2
	MOV TL1,R3
	SETB TR1
CHECK1:
	JBC TF1,OVERFLOW1
	LJMP CHECK1
OVERFLOW1:
	SETB P1.0
	CLR TR1
	LJMP TIME0

INT_KEY1:
	ACALL DELAY50MS	
	ACALL ADD20
	RETI

INT_KEY2:
	ACALL DELAY50MS
	ACALL DEC20
	RETI

ADD20:	
	CLR C
	MOV A,R0
	SUBB A,#0EH
	MOV R0,A
	CLR C
   	MOV A,R1
	SUBB A,#67H
	MOV R1,A
	CLR C
	MOV A,R2
	ADD A,#0EH
	MOV R2,A
	CLR C
	MOV A,R3
	ADD A,#67H
	MOV R3,A
	RET

DEC20:	
	CLR C
	MOV A,R0
	ADD A,#0EH
	MOV R0,A
	CLR C
   	MOV A,R1
	ADD A,#67H
	MOV R1,A
	CLR C
	MOV A,R2
	SUBB A,#0EH
	MOV R2,A
	CLR C
	MOV A,R3
	SUBB A,#67H
	MOV R3,A
	RET

DELAY50MS:			;@11.0592MHz
	NOP
	NOP
	NOP
	PUSH	30H
	PUSH	31H
	PUSH	32H
	MOV		30H,#2
	MOV		31H,#175
	MOV		32H,#72
NEXT50:
	DJNZ	32H,NEXT50
	DJNZ	31H,NEXT50
	DJNZ	30H,NEXT50
	POP		32H
	POP		31H
	POP		30H
	RET


	END
